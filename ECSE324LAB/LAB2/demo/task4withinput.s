    .data
input_image: .word 186, 186, 186, 183, 181, 181, 182, 184, 185, 187, 189, 192, 195, 199, 201, 200, 202, 199, 197, 197, 195, 195, 196, 196, 197, 200, 199, 198, 191, 183, 179, 177
             .word 179, 179, 179, 176, 175, 175, 178, 180, 182, 185, 188, 191, 194, 196, 197, 198, 199, 199, 197, 197, 198, 196, 194, 194, 195, 195, 195, 198, 196, 189, 183, 180
             .word 171, 170, 170, 169, 169, 171, 174, 178, 182, 187, 191, 192, 192, 189, 188, 188, 190, 192, 193, 194, 194, 192, 190, 190, 188, 189, 192, 195, 197, 194, 189, 186
             .word 162, 163, 164, 165, 167, 171, 175, 179, 183, 186, 186, 184, 181, 180, 180, 182, 182, 185, 187, 187, 185, 183, 183, 184, 183, 183, 186, 189, 188, 187, 187, 185
             .word 168, 174, 174, 172, 169, 171, 174, 178, 181, 182, 181, 181, 180, 176, 180, 178, 180, 180, 178, 175, 175, 177, 179, 180, 181, 181, 182, 185, 185, 184, 185, 186
             .word 179, 182, 183, 180, 178, 177, 178, 183, 185, 184, 184, 186, 186, 177, 185, 178, 174, 174, 173, 171, 171, 177, 189, 186, 185, 186, 187, 188, 189, 188, 187, 188
             .word 195, 195, 194, 192, 193, 181, 187, 190, 190, 190, 194, 195, 194, 192, 195, 192, 194, 195, 195, 193, 192, 193, 194, 194, 194, 194, 169, 184, 194, 193, 193, 190
             .word 196, 196, 197, 195, 171, 119, 118, 173, 193, 194, 191, 196, 197, 196, 196, 195, 195, 194, 195, 194, 194, 194, 195, 195, 195, 185, 98,  135, 194, 194, 193, 191
             .word 194, 195, 176, 127, 127, 121, 124, 126, 121, 164, 125, 179, 197, 196, 173, 168, 188, 194, 194, 194, 195, 196, 196, 197, 195, 147, 99,  99,  180, 195, 194, 193
             .word 187, 193, 179, 132, 130, 123, 118, 122, 121, 153, 116, 177, 196, 177, 131, 124, 172, 193, 192, 193, 193, 193, 194, 193, 193, 102, 95,  98,  148, 193, 193, 192
             .word 138, 171, 167, 130, 129, 122, 120, 126, 127, 144, 115, 168, 183, 160, 115, 105, 149, 179, 180, 179, 179, 180, 180, 180, 180, 99,  87,  98,  140, 182, 182, 177
             .word 93,  97,  113, 127, 118, 118, 118, 115, 124, 131, 104, 155, 159, 141, 104, 104, 135, 156, 157, 157, 158, 154, 157, 157, 159, 97,  89,  95,  129, 161, 161, 150
             .word 95,  91,  103, 120, 114, 105, 111, 110, 125, 111, 118, 147, 152, 128, 100, 102, 131, 143, 114, 118, 135, 142, 161, 153, 173, 96,  88,  93,  141, 189, 189, 184
             .word 105, 102, 100, 98,  100, 130, 192, 146, 93,  100, 101, 103, 95,  75,  94,  98,  135, 114, 118, 119, 103, 91,  122, 136, 106, 97,  89,  94,  114, 141, 124, 109
             .word 102, 103, 136, 82,  92,  99,  109, 92,  116, 114, 105, 98,  90,  83,  91,  97,  117, 120, 118, 117, 122, 83,  96,  99,  115, 98,  91,  94,  116, 147, 108, 88
             .word 109, 98,  105, 71,  76,  83,  78,  84,  100, 107, 96,  94,  103, 112, 118, 115, 112, 137, 132, 131, 136, 87,  89,  131, 120, 98,  91,  95,  110, 127, 92,  71
             .word 129, 114, 104, 68,  87,  104, 99,  78,  72,  72,  79,  83,  79,  77,  125, 147, 141, 124, 128, 132, 129, 105, 122, 101, 101, 98,  92,  107, 97,  120, 63,  77
             .word 138, 121, 113, 75,  76,  95,  94,  99,  83,  76,  87,  82,  81,  119, 151, 145, 127, 118, 112, 125, 103, 105, 116, 97,  105, 107, 106, 108, 99,  98,  75,  113
             .word 133, 115, 110, 71,  71,  97,  89,  92,  104, 78,  85,  90,  92,  112, 104, 110, 113, 108, 108, 100, 90,  90,  102, 121, 114, 113, 103, 125, 103, 90,  74,  97
             .word 138, 126, 114, 69,  82,  101, 83,  99,  110, 99,  88,  90,  88,  122, 129, 110, 116, 111, 123, 93,  100, 102, 113, 103, 109, 119, 94,  105, 109, 137, 81,  106
             .word 80,  110, 102, 72,  66,  74,  71,  82,  108, 166, 161, 114, 153, 136, 123, 126, 120, 111, 131, 94,  135, 142, 108, 83,  98,  106, 122, 118, 129, 119, 78,  104
             .word 65,  107, 107, 77,  63,  107, 81,  136, 140, 186, 124, 125, 147, 136, 108, 121, 118, 114, 129, 101, 96,  69,  88,  77,  101, 114, 133, 105, 81,  68,  88,  110
             .word 61,  102, 93,  135, 165, 159, 166, 142, 117, 131, 142, 123, 127, 151, 115, 97,  124, 107, 96,  101, 108, 95,  120, 132, 107, 87,  100, 48,  50,  70,  81,  100
             .word 122, 144, 105, 159, 155, 135, 117, 123, 101, 129, 116, 86,  119, 110, 110, 105, 93,  104, 109, 108, 114, 111, 107, 102, 103, 69,  65,  72,  61,  48,  68,  56
             .word 140, 120, 132, 129, 142, 132, 126, 122, 104, 112, 90,  128, 102, 90,  100, 99,  83,  118, 84,  101, 115, 97,  69,  104, 108, 97,  116, 96,  71,  70,  81,  54
             .word 135, 80,  97,  101, 97,  99,  98,  111, 83,  106, 87,  109, 88,  87,  84,  104, 83,  109, 126, 89,  91,  59,  104, 102, 96,  106, 111, 85,  111, 105, 40,  47
             .word 152, 114, 82,  92,  88,  78,  84,  122, 89,  84,  86,  84,  90,  118, 80,  98,  93,  89,  88,  92,  91,  100, 107, 75,  81,  96,  72,  48,  95,  113, 76,  35
             .word 97,  101, 71,  71,  99,  73,  85,  87,  84,  106, 103, 104, 83,  90,  93,  86,  101, 107, 94,  95,  86,  134, 91,  81,  73,  69,  36,  57,  86,  66,  57,  34
             .word 98,  71,  106, 95,  66,  87,  107, 94,  113, 86,  88,  90,  73,  83,  78,  101, 99,  118, 115, 92,  76,  117, 89,  93,  82,  57,  40,  50,  74,  70,  47,  52
             .word 84,  82,  90,  59,  84,  99,  104, 83,  87,  89,  106, 66,  87,  92,  77,  82,  62,  89,  82,  63,  96,  104, 76,  78,  55,  64,  64,  59,  67,  62,  22,  55
             .word 95,  72,  56,  86,  68,  78,  80,  80,  69,  82,  80,  72,  81,  83,  73,  106, 88,  62,  61,  93,  77,  77,  82,  65,  55,  78,  71,  69,  82,  52,  27,  43
             .word 69,  66,  47,  56,  51,  29,  31,  48,  71,  88,  116, 91,  82,  60,  57,  80,  64,  47,  37,  52,  59,  60,  79,  66,  85,  78,  48,  46,  45,  39,  25,  48

output_image:   // don't refer to this label directly
    .space 1024

    .text
    .global _start
_start:
    LDR R0, =input_image
    LDR R1, =output_image
    MOV R2, #32
    BL sobel
end:
    B end
sobel:
	PUSH {LR}
	MOV R11, R1
	
	
	SUB R10, R2, #2 //size = size - 2
	
	
	MOV R4, #0 //j = 0
OutLoop:

	MOV R5, #0 //i = 0
InLoop:

	//get R8 as the coordinate
	MUL R8, R4, R2		//j*size
	ADD R8, R8, R5		// j*size + i
	LSL R8, R8, #2		// ( j*size + i ) x 4
	//------------------------------------
	B  FUN


FUNEnd:
	ADD R5, R5, #1 // i++
	CMP R5, R10	 // while i < size - 2
	BLT InLoop
	

	ADD R4, R4, #1 // j++
	CMP R4, R10	//while j < size - 2
	BLT OutLoop
	
	
	POP {LR}
    BX LR
	
	
	
	
	
	
FUN:
	PUSH {R4-R7}
	MOV R3, #0		//total = 0
	ADD R4, R0, R8 // im[i,j] = base + ( j*size + i ) x 4 
	LDR R5, [R4]  // the value at im[i,j]
	ADD R3, R3, R5	//total += im[i,j]
	
	ADD R4, R4, #8 // im[i+2,j]
	LDR R5, [R4]  // the value at im[i+2,j]
	SUB R3, R3, R5	//total -= im[i+2,j]
	
	ADD R4, R4, R10, LSL#2 //im[i,j+1]
	LDR R5, [R4]  // the value at im[i,j+1]
	ADD R3, R3, R5 //total -= im[,j+1]
	ADD R3, R3, R5 //add twice
	
	ADD R4, R4, #8 //im[i+2,j+1]
	LDR R5, [R4]  
	SUB R3, R3, R5 //minus twice
	SUB R3, R3, R5
	
	
	ADD R4, R4, R10, LSL#2 //im[i,j+2]
	LDR R5, [R4]
	ADD R3, R3, R5 

	
	ADD R4, R4, #8 //im[i+2,j+2]
	LDR R5, [R4]  
	SUB R3, R3, R5 
	
	STR R3, [R11]
	ADD R11, R11, #4
	
	POP  {R4-R7}
	B  FUNEnd
	


	
	
	
	
	